<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Call Traces</title>
    <style>
        #tracetable {
            font-family: "Trebuchet MS", Arial, Helvetica, sans-serif;
            border-collapse: collapse;
            width: 100%;
        }

            #tracetable td, #tracetable th {
                border: 1px solid #ddd;
                padding: 8px;
            }

            #tracetable tr:nth-child(even) {
                background-color: #f2f2f2;
            }

            #tracetable tr:hover {
                background-color: #ddd;
            }

            #tracetable th {
                padding-top: 12px;
                padding-bottom: 12px;
                text-align: left;
                background-color: #4CAF50;
                color: white;
            }
    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script> 
    <script>
        var header = document.querySelector('header');
        var section = document.querySelector('section');
        var requestURL;

        function onButtonClick() {
            var pageSize = document.getElementById("pageSize").value;
            var pageNumber = document.getElementById("pageNumber").value - 1;
            var hostName = document.getElementById("hostName").value;
            var responseCode = document.getElementById("responseCode").value;
            var fromTimestamp = document.getElementById("fromTimestamp").value;
            var toTimestamp = document.getElementById("toTimestamp").value;

            var e = document.getElementById("reqMethod");
            var methodType = e.options[e.selectedIndex].text;

            e = document.getElementById("traceType");
            var traceType = e.options[e.selectedIndex].text;
            

            requestURL = 'http://localhost:62150/trace'; //Fix this hard coding plus will jQ work from CDN when offline http://localhost:57916/trace
            var postString = '?page=' + pageNumber + "&size=" + pageSize;

            // Method Filter
            if (methodType !="ALL") {
                postString = postString + "&method=" + methodType;
            }

            //Type Filter
            if (traceType != "ALL") {
                postString = postString + "&type=" + traceType;
            }

            //Time Filter
            if (hostName.length != 0 && fromTimestamp.length != 0) {
                postString = postString + "&starttimestamp=" + fromTimestamp;
                postString = postString + "&stoptimestamp=" + toTimestamp;
            }

            //Response Code Filter
            if (responseCode.length != 0) {
                postString = postString + "&code=" + responseCode;
            }          

            //Host Filter
            if (hostName.length != 0) {
                postString = postString + "&host=" + hostName;
            }       

            
            requestURL = requestURL + postString;
            requestTraces();
        }

        function requestTraces() {
            var request = new XMLHttpRequest();
            request.open('GET', requestURL);
            request.responseType = 'json';
            request.send();
            request.onload = function () {
                var traces = request.response;
                console.log(traces);
                showTracesTable(traces);
            }
        }

        function showTracesTable(jsonObj) {
            var table = document.getElementById("tracetable");
            $("#tracetable").find("tr:not(:first)").remove(); //jQ
            for (var i = 0; i < jsonObj.length; i++) {
                var j = 0
                // Create Row.
                var row = table.insertRow(i + 1);
                // Populate Columns.
                var _id = row.insertCell(j++).innerHTML = jsonObj[i].Id;
                var _type = row.insertCell(j++).innerHTML = jsonObj[i].Type;
                var _requestContent = row.insertCell(j++).innerHTML = jsonObj[i].RequestContent;
                var _requestContentType = row.insertCell(j++).innerHTML = jsonObj[i].RequestContentType;
                var _requestHost = row.insertCell(j++).innerHTML = jsonObj[i].RequestHost;
                var _requestUri = row.insertCell(j++).innerHTML = jsonObj[i].RequestUri;
                var _requestMethod = row.insertCell(j++).innerHTML = jsonObj[i].RequestMethod;
                var _requestTimestamp = row.insertCell(j++).innerHTML = jsonObj[i].RequestTimestamp;
                var _responseContent = row.insertCell(j++).innerHTML = jsonObj[i].ResponseContent;
                var _responseContentType = row.insertCell(j++).innerHTML = jsonObj[i].ResponseContentType;
                var _responseStatusCode = row.insertCell(j++).innerHTML = jsonObj[i].ResponseStatusCode;
                var _responseTimestamp = row.insertCell(j++).innerHTML = jsonObj[i].ResponseTimestamp;
                var _responseTimeMs = row.insertCell(j++).innerHTML = jsonObj[i].ResponseTimeMs;
            }

        }
    </script>
    <noscript>Sorry, your browser does not support JavaScript!</noscript>
</head>

<body>
    <header></header>

    <options>



        Page-Size:<input type="text" id="pageSize" value="20">
        Page-Number:<input type="text" id="pageNumber" value="1">
        Host-Name:<input type="text" id="hostName" value="">
        Response-Code:<input type="text" id="responseCode" value="">
        From-Timestamp:<input type="text" id="fromTimestamp" value="">
        To-Timestamp:<input type="text" id="toTimestamp" value="">
        <br/>

        <label>Request Method</label>
        <select id="reqMethod">
            <option value="ALL">ALL</option>
            <option value="GET">GET</option>
            <option value="POST">POST</option>
            <option value="PUT">PUT</option>
            <option value="PATCH">PATCH</option>
            <option value="DELETE">DELETE</option>
            <option value="OPTIONS">OPTIONS</option>
        </select>

        <label>Trace Type</label>
        <select id="traceType">
            <option value="ALL">ALL</option>
            <option value="GET">REGULAR</option>
            <option value="POST">ERROR</option>
            <option value="PUT">WARNING</option>
        </select>



        <button onclick="onButtonClick()">Go</button>



        <br />
    </options>

    <section>
        <table id="tracetable">
            <tr>
                <th>Id</th>
                <th>Type</th>
                <th>Request Content</th>
                <th>Request Content Type</th>
                <th>Request Host</th>
                <th>Request Uri</th>
                <th>Request Method</th>
                <th>Request Timestamp</th>
                <th>Response Content</th>
                <th>Response Content Type</th>
                <th>Response Status</th>
                <th>Response Timestamp</th>
                <th>Response TimeMs</th>
            </tr>
        </table>
    </section>

</body>

</html>